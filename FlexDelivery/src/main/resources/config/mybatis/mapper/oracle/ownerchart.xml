<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.ownerchart">
	
	<!--  지난주 주문 수 -->
	<select id="selectLastWeekOrderCount" parameterType="int" resultType="map">
			select count(*)  ordersCount, to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') as ordersDay,to_char(to_date(orders_date)+orders_duration/(24*60),'D') as ordersWoD  from orders
					where to_date(orders_date)+orders_duration/(24*60) between trunc(sysdate-7,'IW') and trunc(sysdate-7,'IW')+7 and store_no=#{storeNo} and o_status_no=4
					group by to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') ,to_char(to_date(orders_date)+orders_duration/(24*60),'D'), store_no
					order by ordersDay
	</select>
	
	<!--  이번주 주문 수 -->
	<select id="selectThisWeekOrderCount" parameterType="int" resultType="map">
			select count(*) ordersCount, to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') as ordersDay,to_char(to_date(orders_date)+orders_duration/(24*60),'D') as ordersWoD  from orders
				where to_date(orders_date)+orders_duration/(24*60)  between trunc(sysdate,'IW') and trunc(sysdate,'IW')+7 and store_no=#{storeNo} and o_status_no=4
				group by to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD'),to_char(to_date(orders_date)+orders_duration/(24*60),'D'), store_no
				order by ordersDay
	</select>
	
	
	<!--  지난주 주문 가격 -->
	<select id="selectLastWeekOrderPrice" parameterType="int" resultType="map">
			select sum(orders_price)  ordersPrice, to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') as ordersDay, to_char(to_date(orders_date)+orders_duration/(24*60),'D') as ordersWoD  from orders
				where to_date(orders_date)+orders_duration/(24*60)  between trunc(sysdate-7,'IW') and trunc(sysdate-7,'IW')+7 and store_no=#{storeNo} and o_status_no=4
				group by to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') , to_char(to_date(orders_date)+orders_duration/(24*60),'D')
				order by ordersDay
	</select>
	
	<!--  이번주 주문 가격 -->
	<select id="selectThisWeekOrderPrice" parameterType="int" resultType="map">
			select sum(orders_price) ordersPrice, to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') as ordersDay, to_char(to_date(orders_date)+orders_duration/(24*60),'D') as ordersWoD  from orders
				where to_date(orders_date)+orders_duration/(24*60)  between trunc(sysdate,'IW') and trunc(sysdate,'IW')+7 and store_no=#{storeNo} and o_status_no=4
				group by to_char(to_date(orders_date)+orders_duration/(24*60),'YYYY-MM-DD') , to_char(to_date(orders_date)+orders_duration/(24*60),'D')
				order by ordersDay
	</select>
	
	
	<!-- 베스트  주문 메뉴  -->
	<select id="selectBestMenu" parameterType="int" resultType="map">
			select sum(o_detail_qty),menu_name from jaordersbestmenuview
			<![CDATA[
			where store_no=#{storeNo} and rownum <=5 and o_status_no=4 and to_date(orders_date)+orders_duration/(24*60) >= add_months(sysdate,-1)
			]]> 
			group by menu_name
	</select>
</mapper>
