<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.memberCoupon">
	<!-- create or replace view hyStoreCouponBoxView
	as
	select s.*,r.r_coupon_dc,r_coupon_min
	from
	regularcoupon r,storecouponbox s
	where r.R_COUPON_NO = s.R_COUPON_NO; -->

	<select id="storeCouponList" parameterType="map" resultType="memberStoresCouponVo">
		select hy.*,
		(select count(*) from regularcouponbox b where hy.s_c_box_no=b.s_c_box_no and b.member_no=#{memberNo})
		as dupChk,
		(select b.r_c_box_use from regularcouponbox b where hy.s_c_box_no=b.s_c_box_no and b.member_no=#{memberNo})
		as r_c_box_use
		from
		hystorecouponboxview hy
		where hy.store_no=#{storeNo}
		and hy.s_c_service='Y'
		and sysdate>hy.s_c_start_date
		<![CDATA[
		and sysdate<hy.s_c_end_date
		]]>
		order by hy.r_coupon_min
	</select>
	
	<select id="memberCouponList" parameterType="int" resultType="memberRegularCouponBoxVo">
		select * from regularcouponbox
		where member_No=#{memberNo}
		and r_c_box_end>sysdate
	</select>
	
	<insert id="addCoupon" parameterType="memberRegularCouponBoxVo">
		insert into regularCouponBox(member_no,s_c_box_no)
		values(#{memberNo},#{sCBoxNo})
	</insert>
</mapper>
