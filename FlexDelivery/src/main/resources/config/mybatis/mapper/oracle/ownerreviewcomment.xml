<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.ownerreviewcomment">

	<insert id="insertComm" parameterType="ownerReviewCommentVo">
		insert into REVIEWCOMMENT(REVIEW_NO,STORE_NO,R_COMMENT_CONTENT)
		values(#{reviewNo},#{storeNo},#{rCommentContent})
	</insert>
	
	<!-- 
 create or replace view LSJCommentDDetailView
   as
     select r.*, m.MEMBER_ID, c.R_COMMENT_CONTENT,c.R_COMMENT_REGDATE,
      n.MENU_NAME,d.O_DETAIL_QTY, o.M_OPTION_NAME
      from MEMBER m full outer join  REVIEW r
        on r.MEMBER_NO=m.MEMBER_NO
        full outer join REVIEWCOMMENT c
        on c.store_no=r.store_no and c.REVIEW_NO=r.REVIEW_NO
        full outer join  ORDERDETAIL d
        on r.ORDERS_NO=d.ORDERS_NO full outer join MENU n
        on n.MENU_NO=d.MENU_NO
        full outer join MENUOPTION o
        on d.M_OPTION_NO=o.M_OPTION_NO;
        
	 -->
	
	<select id="selectReView" parameterType="ownerReviewSearchVo" resultType="map">
		select *
		from
		(
		    select A.*, rownum as RNUM
		    from
		    (
		        select * from LSJCommentDDetailView
				where REVIEW_REGDATE >= #{startDay} and
				<![CDATA[
				REVIEW_REGDATE< to_date(#{endDay})+1
				]]>
                and store_no=#{storeNo}
				order by ORDERS_NO desc
		    )A
		)
		
		<![CDATA[
		where RNUM > #{firstRecordIndex} 
		and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
		]]>
	</select>
	
		<select id="getTotalRecord" parameterType="ownerReviewSearchVo" resultType="int">
		select count(*) from LSJCommentDDetailView
		where REVIEW_REGDATE >= #{startDay} and
		<![CDATA[
		REVIEW_REGDATE< to_date(#{endDay})+1
		]]>
			and store_no=#{storeNo}
	</select>
    
          
</mapper>
