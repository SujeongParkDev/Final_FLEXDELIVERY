<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="config.mybatis.mapper.oracle.ownerreviewcomment">

	<insert id="insertComm" parameterType="ownerReviewCommentVo">
		insert into
		REVIEWCOMMENT(REVIEW_NO,STORE_NO,R_COMMENT_CONTENT)
		values(#{reviewNo},#{storeNo},#{rCommentContent})
	</insert>

	<!-- create or replace view LSJCommentDDetailView as select r.*, m.MEMBER_ID, 
		c.R_COMMENT_CONTENT,c.R_COMMENT_REGDATE, n.MENU_NAME,d.O_DETAIL_QTY, o.M_OPTION_NAME 
		from MEMBER m full outer join REVIEW r on r.MEMBER_NO=m.MEMBER_NO full outer 
		join REVIEWCOMMENT c on c.store_no=r.store_no and c.REVIEW_NO=r.REVIEW_NO 
		full outer join ORDERDETAIL d on r.ORDERS_NO=d.ORDERS_NO full outer join 
		MENU n on n.MENU_NO=d.MENU_NO full outer join MENUOPTION o on d.M_OPTION_NO=o.M_OPTION_NO; 
		<select id="selectReView" parameterType="ownerReviewSearchVo" resultType="map"> 
		select * from ( select A.*, rownum as RNUM from ( select * from LSJCommentDDetailView 
		where REVIEW_REGDATE >= #{startDay} and <![CDATA[ REVIEW_REGDATE< to_date(#{endDay})+1 
		]]> and store_no=#{storeNo} order by ORDERS_NO desc )A ) <![CDATA[ where 
		RNUM > #{firstRecordIndex} and RNUM <= #{firstRecordIndex} + #{recordCountPerPage} 
		]]> </select> -->
	<select id="selectReView" parameterType="ownerReviewSearchVo" resultType="map">
		select *
		from
		(
		    select A.*, rownum as RNUM
		    from
		    (
		        select * from LSJCommentDDetailView
                where store_no=#{storeNo}
                <![CDATA[
				and REVIEW_REGDATE >= #{startDay} and
				REVIEW_REGDATE< to_date(#{endDay})+1
				]]>
                order by ORDERS_NO desc
		    )A
		)
		<![CDATA[
		where RNUM > #{firstRecordIndex} 
		and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
		]]>
	</select>

	<select id="getTotalRecord" parameterType="ownerReviewSearchVo" resultType="int">
		select count(*) from LSJCommentDDetailView
		<![CDATA[
		where REVIEW_REGDATE >= #{startDay} and
		REVIEW_REGDATE< to_date(#{endDay})+1
		]]>
		and store_no=#{storeNo}
	</select>

	<select id="memberInfoView" parameterType="int" resultType="map">
		select * from LSJreviewidView where store_no=#{storeNo}
	</select>

	<delete id="deleteComm" parameterType="int">
		delete from reviewcomment where review_no=#{reviewNo}
	</delete>

	<select id="selectByNo" parameterType="int" resultType="ownerReviewCommentVo">
		select * from reviewcomment where review_no=#{reviewNo}
	</select>

	<update id="updateComm" parameterType="ownerReviewCommentVo">
		update reviewcomment
		set R_COMMENT_CONTENT=#{rCommentContent}
		where review_no=#{reviewNo}
	</update>
	
	<!-- 미답변  -->
	<select id="Nocomment" parameterType="int" resultType="map">
		select * from LSJCommentDDetailView
      	 where store_no=#{storeNo} and R_COMMENT_CONTENT is null
     	 order by ORDERS_NO desc
	</select>

	<select id="NocmtTotalRecord" parameterType="int" resultType="int">
		select count(*) from LSJCommentDDetailView
         where store_no=#{storeNo} and R_COMMENT_CONTENT is null
         order by ORDERS_NO desc
	</select>
	
	<!-- 차단  -->
	<select id="blockcmt" parameterType="int" resultType="map">
		select * from LSJCommentDDetailView
         where store_no=#{storeNo} and  REVIEW_REPORT='Y'
         order by ORDERS_NO desc
	</select>

	<select id="blockTotalRecord" parameterType="int" resultType="int">
		select count(*) from LSJCommentDDetailView
         where store_no=#{storeNo} and  REVIEW_REPORT='Y'
         order by ORDERS_NO desc
	</select>
	
	<select id="selectAll" parameterType="int" resultType="map">
		select * from LSJCommentDDetailView
		where store_no=#{storeNo}
		order by orders_no desc
	</select>
	
	<select id="avgReting5" parameterType="int" resultType="int">
		select avg(nvl(REVIEW_RATING,0)) as "RATING5" from review 
		where store_no=#{storeNo} and review_rating=5
	</select>
	
</mapper>
